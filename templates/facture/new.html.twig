{% extends 'base.html.twig' %}

{% block title %}Cr√©er une facture
{% endblock %}

{% block body %}
	<h1 class="text-3xl font-bold mb-6 text-center">Nouvelle facture</h1>

	<form
		method="post" class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 space-y-8">

		<!-- Informations facture -->
		<div class="grid grid-cols-1 md:grid-cols-4 gap-6 border-b pb-6">
			<div>
				<label for="numeroFacture" class="block text-sm font-medium">Num√©ro facture</label>
				<input type="text" id="numeroFacture" name="numeroFacture" required class="w-full border rounded px-3 py-2">
			</div>
			<div>
				<label for="dateFacture" class="block text-sm font-medium">Date facture</label>
				<input type="date" id="dateFacture" name="dateFacture" required class="w-full border rounded px-3 py-2">
			</div>
			<div>
				<label for="typeFacture" class="block text-sm font-medium">Type</label>
				<input type="text" id="typeFacture" name="typeFacture" maxlength="10" required class="w-full border rounded px-3 py-2">
			</div>
			<div>
				<label for="devise" class="block text-sm font-medium">Devise</label>
				<select id="devise" name="devise" required class="w-full border rounded px-3 py-2">
					<option value="">Choisir</option>
					<option value="EUR">EUR - Euro</option>
					<option value="USD">USD - Dollar</option>
					<option value="GBP">GBP - Livre</option>
					<option value="CHF">CHF - Franc Suisse</option>
					<option value="JPY">JPY - Yen</option>
				</select>
			</div>
		</div>

		<!-- Fournisseur & Acheteur -->
		<div
			class="grid grid-cols-1 md:grid-cols-2 gap-6 border-b pb-6">
			<!-- Fournisseur -->
			<div>
				<h2 class="text-xl font-semibold mb-4">Fournisseur</h2>
				<label for="nomFournisseur" class="block text-sm font-medium">Nom</label>
				<input type="text" id="nomFournisseur" name="nomFournisseur" class="w-full border rounded px-3 py-2 mb-3">

				<label for="sirenFournisseur" class="block text-sm font-medium">SIREN</label>
				<input type="text" id="sirenFournisseur" name="sirenFournisseur" class="w-full border rounded px-3 py-2 mb-3">

				<label for="siretFournisseur" class="block text-sm font-medium">SIRET</label>
				<input type="text" id="siretFournisseur" name="siretFournisseur" class="w-full border rounded px-3 py-2 mb-3">

				<label for="tvaFournisseur" class="block text-sm font-medium">N¬∞ TVA</label>
				<input type="text" id="tvaFournisseur" name="tvaFournisseur" class="w-full border rounded px-3 py-2 mb-3">

				<label for="codePaysFournisseur" class="block text-sm font-medium">Pays</label>
				<select id="codePaysFournisseur" name="codePaysFournisseur" class="w-full border rounded px-3 py-2 mb-3">
					<option value="">S√©lectionner</option>
					<option value="FR">France</option>
					<option value="DE">Allemagne</option>
					<option value="IT">Italie</option>
				</select>

				<label for="emailFournisseur" class="block text-sm font-medium">Email</label>
				<input type="email" id="emailFournisseur" name="emailFournisseur" class="w-full border rounded px-3 py-2">
			</div>

			<!-- Acheteur -->
			<div>
				<h2 class="text-xl font-semibold mb-4">Acheteur</h2>
				<label for="nomAcheteur" class="block text-sm font-medium">Nom</label>
				<input type="text" id="nomAcheteur" name="nomAcheteur" class="w-full border rounded px-3 py-2 mb-3">

				<label for="sirenAcheteur" class="block text-sm font-medium">SIREN</label>
				<input type="text" id="sirenAcheteur" name="sirenAcheteur" class="w-full border rounded px-3 py-2 mb-3">

				<label for="emailAcheteur" class="block text-sm font-medium">Email</label>
				<input type="email" id="emailAcheteur" name="emailAcheteur" class="w-full border rounded px-3 py-2">
			</div>
		</div>

		<!-- Lignes de facture -->
		<div class="border-b pb-6">
			<h2 class="text-xl font-semibold mb-4">Lignes de facture</h2>
			<div id="lignes-container" class="space-y-3">
				<div class="grid grid-cols-6 gap-3 items-end border p-4 rounded bg-gray-50">
					<input type="text" name="lignes[0][designation]" placeholder="D√©signation" class="col-span-2 border rounded px-2 py-1">
					<input type="text" name="lignes[0][reference]" placeholder="R√©f." class="col-span-1 border rounded px-2 py-1">
					<input type="number" step="0.01" name="lignes[0][quantite]" placeholder="Qt√©" class="col-span-1 border rounded px-2 py-1">
					<input type="number" step="0.01" name="lignes[0][prixUnitaireHT]" placeholder="PU HT" class="col-span-1 border rounded px-2 py-1">
					<input type="number" step="0.01" name="lignes[0][tauxTVA]" placeholder="TVA %" class="col-span-1 border rounded px-2 py-1">
				</div>
			</div>
			<button type="button" onclick="ajouterLigne()" class="bg-green-600 text-white px-4 py-2 rounded mt-3">
				+ Ajouter une ligne
			</button>
		</div>

		<!-- Paiement -->
		<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
			<div>
				<label for="dateEcheance" class="block text-sm font-medium">Date √©ch√©ance</label>
				<input type="date" id="dateEcheance" name="dateEcheance" class="w-full border rounded px-3 py-2">
			</div>
			<div>
				<label for="modePaiement" class="block text-sm font-medium">Mode de paiement</label>
				<select id="modePaiement" name="modePaiement" class="w-full border rounded px-3 py-2">
					<option value="">S√©lectionner</option>
					<option value="10">Esp√®ces</option>
					<option value="20">Ch√®que</option>
					<option value="30">Virement</option>
				</select>
			</div>
			<div>
				<label for="referencePaiement" class="block text-sm font-medium">R√©f√©rence</label>
				<input type="text" id="referencePaiement" name="referencePaiement" class="w-full border rounded px-3 py-2">
			</div>
		</div>

		<!-- Profil Factur-X -->
		<div>
			<label for="profilFacturX" class="block text-sm font-medium">Profil Factur-X</label>
			<select id="profilFacturX" name="profilFacturX" required class="w-full border rounded px-3 py-2">
				<option value="">S√©lectionner</option>
				<option value="MINIMUM">Minimum</option>
				<option value="BASIC">Basic</option>
				<option value="EN16931">EN16931</option>
				<option value="EXTENDED">Extended</option>
			</select>
		</div>

		<!-- Bouton -->
		<div class="flex justify-end">
			<button type="submit" class="bg-indigo-600 text-white font-bold px-6 py-3 rounded hover:bg-indigo-700 transition">
				üíæ Enregistrer la facture
			</button>
		</div>
	</form>

	<script>
		let index = 1;
function ajouterLigne() {
const container = document.getElementById("lignes-container");
const ligne = container.firstElementChild.cloneNode(true);
ligne.querySelectorAll("input").forEach(input => {
input.name = input.name.replace(/\[\d+\]/, `[${index}]`);
input.value = "";
});
container.appendChild(ligne);
index++;
}
	</script>
{% endblock %}

